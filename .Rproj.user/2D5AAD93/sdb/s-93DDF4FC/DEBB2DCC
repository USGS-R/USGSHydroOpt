{
    "contents" : "#' getIndexes\n#'\n#' Computes humification index and fluorescence indes from fluorescence data. HIX\n#' as defined by Ohno, 2002,   Fluorescence inner-filtering correction for determining\n#' the humification index of dissolved organic matter. Environ. Sci. Technol. 36: 742-746\n#' doi: 10.1021/es0155276, HIX = sum(I435:I480)/(sum(I300:I345)+sum(I435:I480)) for ex=254 and FI_2005 as defined by Cory and McKnight, 2005, \n#' Fluorescence spectroscopy reveals ubiquitous presence of oxidized and reduced quinones in DOM. Environ. Sci. Technol. 39: 8142-8149, \n#' doi:10.1021/es0506962 and FI_2001 defined by MCKNIGHT, D. M., E. W. BOYER, P. K. WESTERHOFF, P. T. DORAN, T. KULBE, AND D. T. ANDERSEN. 2001. \n#' Spectrofluorometric characterization of DOM for indication of precursor material and aromaticity. Limnol. Oceanogr. 46: 38-48, doi:10.4319/lo.2001.46.1.0038.\n#' FI = ex370em470/ex370em520 and freshness index as defined by PARLANTI, E., K. WORZ, L. GEOFFROY, AND M. LAMOTTE. \n#' 2000. Dissolved organic matter fluorescence spectroscopy as a tool to estimate biological activity in a coastal zone submitted to anthropogenic inputs. Org. Geochem. 31: 1765-1781, doi:10.1016/S0146-6380(00)00124-8\n#' FreshI = ex310em380/max(ex310 between em470 and em520),\n#'\n#' @param a an array with 3-D fluorescence  results. The 3 dimensions are the excitation wavelength (character), the emission wavelength (character), and the sample number (character).\n#' @param dataSummary dataframe with summary absorbance and fluoresence data. This \n#' function adds columns to the end of this dataframe as additional summary data.\n#' @param grnum character column name that defines the grnumbers (sample numbers) in the dataSummary dataframe.\n#' These names are used to merge spectral slope data into the summary dataframe. \n#' This function assumes the column names of the dataAbs are grnumbers as well.\n#' @return dataSummary dataframe with the additional columns containing the humification and fluoresence indices.\n#' @export\n#' @examples\n#' a <- a\n#' dataSummary <- dfsummary \n#' dataSummary <- dataSummary[,-c(43:46)] #remove columns with fluoresence and humic index\n#' grnum <- \"GRnumber\"\n#' test1 <- getIndexes(a,dataSummary,grnum)\ngetIndexes <- function(a,dataSummary,grnum){\n  a <- a[,,dataSummary[,grnum]]\n  \n  grnums <- names(a[1,1,])\n  Em <- as.numeric(names(a[1,,1]))\n  Ex <- as.numeric(names(a[,1,1]))\n  Ex254 <- which.min(abs(Ex-254))\n  H1cols <- which(Em >=435 & Em<=480)\n  H2cols <- which(Em >=300 & Em<=345)\n  \n  HIX <- numeric()\n  FI <- numeric()\n  FI_2001 <- numeric()\n  FreshI <- numeric()\n  for(j in 1:length(grnums)){\n    if(sum(Ex==254)>0) {Ex254 <- a[Ex254,,j]\n  }else{\n    wv1 <- max(Ex[which(Ex<254)])\n    wv2 <- min(Ex[which(Ex>254)])\n    frac1 <- 1-(254-wv1)/(wv2-wv1)\n    frac2 <- 1-(wv2-254)/(wv2-wv1)\n    Ex254 <- frac1 * a[as.character(wv1),,j] + frac2 * a[as.character(wv2),,j]\n    }\n  HIX <- c(HIX,sum(Ex254[H1cols])/(sum(Ex254[H1cols]) + sum(Ex254[H2cols])))\n  \n  FI <- c(FI,a[\"370\",\"470\",j]/a[\"370\",\"520\",j])\n  FI_2001 <- c(FI_2001,a[\"370\",\"450\",j]/a[\"370\",\"500\",j])\n  which(Em==470)\n  FreshI <- c(FreshI,a[\"310\",\"380\",j]/max(a[\"310\",c(which(Em==470):which(Em==520)),j]))\n  }\n  Indices <- data.frame(GRnumber=grnums,HIX_2002=HIX,FI_2005=FI,FI_2001=FI_2001,FreshI=FreshI)\n  merge(dataSummary,Indices,by=grnum,all=TRUE)\n}\n",
    "created" : 1403704219079.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "395127445",
    "id" : "DEBB2DCC",
    "lastKnownWriteTime" : 1403124137,
    "path" : "D:/stcData/R_projects/USGSHydroOpt/R/HixFIFxn.R",
    "project_path" : "R/HixFIFxn.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}